---
# Main Site Playbook - Orchestrates all roles
# Run with: ansible-playbook playbooks/site.yml

- name: Configure all hosts
  hosts: all
  gather_facts: yes
  tasks:
    - name: Display host information
      debug:
        msg: "Configuring {{ inventory_hostname }} ({{ ansible_os_family }})"

- name: Apply common role to all hosts
  hosts: all
  become: yes
  roles:
    - role: common
      tags: [always, common]

- name: Configure web servers
  hosts: webservers
  become: yes
  roles:
    - role: nginx
      tags: [nginx, webservers]

- name: Configure application servers
  hosts: appservers
  become: yes
  roles:
    - role: nodejs
      tags: [nodejs, appservers]
    - role: docker
      tags: [docker]
    - role: docker_deploy
      tags: [deploy, docker]

- name: Apply security hardening
  hosts: all
  become: yes
  roles:
    - role: security
      tags: [security, hardening]

- name: Setup monitoring
  hosts: all
  become: yes
  roles:
    - role: monitoring
      tags: [monitoring, observability]

- name: Post-deployment verification
  hosts: all
  tasks:
    - name: Verify connectivity
      ping:

    - name: Show deployment summary
      debug:
        msg:
          - "Host: {{ inventory_hostname }}"
          - "Environment: {{ environment | default('staging') }}"
          - "Deployment completed successfully!"
